---
import { getCollection } from 'astro:content';

// 모든 블로그 글 가져오기
const allPosts = await getCollection('blog');

// 태그 개수 계산
const tagCountMap = new Map<string, number>();
allPosts.forEach((post) => {
	const tags = post.data.tags || [];
	tags.forEach((tag) => {
		const currentCount = tagCountMap.get(tag) || 0;
		tagCountMap.set(tag, currentCount + 1);
	});
});

// 태그 배열로 변환하고 개수 순으로 정렬
const tags = Array.from(tagCountMap.entries())
	.map(([name, count]) => ({ name, count }))
	.sort((a, b) => b.count - a.count);
---

<div class="tag-sidebar">
	<h2>Tags</h2>
	<ul class="tag-list">
		{
			tags.length > 0 ? (
				tags.map((tag) => (
					<li class="tag-item">
						<a href={`/tags/${encodeURIComponent(tag.name)}`}>
							<span class="tag-name">{tag.name}</span>
							<span class="tag-count">({tag.count})</span>
						</a>
					</li>
				))
			) : (
				<li class="tag-item">
					<span class="no-tags">태그가 없습니다</span>
				</li>
			)
		}
	</ul>
</div>

<style>
	.tag-sidebar {
		background-color: rgba(26, 26, 46, 0.8);
		padding: 1.5em;
		border: 1px solid #00ff41;
		border-radius: 4px;
		box-shadow: 0 0 10px rgba(0, 255, 65, 0.1);
		box-sizing: border-box;
		width: 100%;
	}

	.tag-sidebar h2 {
		font-family: 'Pretendard', 'Courier New', monospace;
		font-size: 1.25em;
		margin: 0 0 1em 0;
		color: #00ff41;
		border-bottom: 2px solid #00ff41;
		padding-bottom: 0.5em;
		text-shadow: 2px 2px 0 #16213e;
		letter-spacing: 0.1em;
	}

	.tag-list {
		list-style: none;
		padding: 0;
		margin: 0;
	}

	.tag-item {
		margin-bottom: 0.5em;
	}

	.tag-item a {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 0.5em 0.8em;
		border-radius: 2px;
		text-decoration: none;
		color: #e5e9f0;
		font-family: 'Pretendard', 'Courier New', monospace;
		transition: all 0.2s ease;
		border: 1px solid transparent;
	}

	.tag-item a:hover {
		background-color: rgba(0, 255, 65, 0.1);
		border-color: #00ff41;
		color: #ffd700;
		transform: translateX(4px);
		box-shadow: 2px 2px 0 0 rgba(0, 255, 65, 0.2);
	}

	.tag-name {
		font-weight: 700;
	}

	.tag-count {
		color: #00ff41;
		font-size: 0.9em;
		margin-left: 0.5em;
	}
	
	.tag-item a:hover .tag-count {
		color: #ffd700;
	}

	.no-tags {
		color: rgb(var(--gray));
		font-size: 0.9em;
		font-family: 'Pretendard', 'Courier New', monospace;
	}

	/* 모바일 반응형 */
	@media (max-width: 1279px) {
		/* 사이드바가 BaseLayout에서 숨겨질 수 있지만, 혹시 모를 상황 대비 */
		.tag-sidebar {
			position: static;
			max-height: none;
			margin-bottom: 2rem;
			border: 1px solid rgba(0, 255, 65, 0.3);
		}
		
		.tag-list {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5em;
		}

		.tag-item {
			margin-bottom: 0;
		}
		
		.tag-item a {
			border: 1px solid rgba(0, 255, 65, 0.3);
		}
	}
</style>
