---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Hero from '../components/sections/Hero.astro';
import About from '../components/sections/About.astro';
import Projects from '../components/sections/Projects.astro';
import Experience from '../components/sections/Experience.astro';
import Skills from '../components/sections/Skills.astro';
import Certificates from '../components/sections/Certificates.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import { experiences, experiencesKo, projects, projectsKo, aboutMe } from '../consts/data';
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <div class="min-h-screen bg-white font-sans text-gray-900">
    
    <Header githubUrl="https://github.com/heejunp" blogUrl="https://blog.heejunp.com" />
    
    <main class="h-auto overflow-auto md:h-screen md:overflow-y-scroll md:snap-y md:snap-mandatory scroll-smooth relative">
      {/* Floating Language Switcher */}
      <div class="fixed top-24 right-6 z-50 flex flex-col gap-2 group">
        <button 
          id="lang-toggle"
          class="bg-black/80 hover:bg-black text-white p-3 rounded-full shadow-xl transition-all hover:scale-110 active:scale-95 border border-white/20 backdrop-blur-md"
          aria-label="Switch Language"
        >
          <span class="font-bold text-xs tracking-wider" id="lang-label">KR</span>
        </button>
      </div>

      <div class="md:snap-start">
        <Hero 
          name="Heejun Park" 
          tagline="Bridging Web and Infra: Engineering reliable systems from a full-stack perspective." 
        />
      </div>

      <div class="md:snap-start min-h-screen flex items-center justify-center bg-gray-50">
        <div class="w-full h-full flex flex-col justify-center">
          <Projects projects={projects} projectsKo={projectsKo} />
        </div>
      </div>

      <div class="md:snap-start">
        <About {...aboutMe} />
      </div>
      
      <div class="md:snap-start">
        <Skills />
      </div>

      <div id="experience" class="md:snap-start min-h-screen flex items-center justify-center bg-gray-50">
        <div class="w-full max-w-4xl mx-auto py-20">
          <Experience title="Experience" items={experiences} itemsKo={experiencesKo} />
        </div>
      </div>

      <div class="md:snap-start min-h-screen flex items-center justify-center bg-white">
        <div class="w-full">
           <Certificates />
        </div>
      </div>

    </main>
    
  </div>
</BaseLayout>

<style>
  html {
    scroll-behavior: smooth;
  }
  
  /* Language Toggle Logic */
  :global(body.lang-ko) :global(.lang-en) {
    display: none !important;
  }
  :global(body:not(.lang-ko)) :global(.lang-ko) {
    display: none !important;
  }
</style>

<script>
  // Language Toggle Script
  const initLang = () => {
    const btn = document.getElementById('lang-toggle');
    const label = document.getElementById('lang-label');
    const body = document.body;

    // Check saved preference
    const savedLang = localStorage.getItem('language');
    if (savedLang === 'ko') {
      body.classList.add('lang-ko');
      if (label) label.textContent = 'EN';
    } else {
      body.classList.remove('lang-ko');
      if (label) label.textContent = 'KR';
    }

    if (btn) {
      btn.addEventListener('click', () => {
        body.classList.toggle('lang-ko');
        const isKo = body.classList.contains('lang-ko');
        
        // Update Label
        if (label) label.textContent = isKo ? 'EN' : 'KR';
        
        // Save preference
        localStorage.setItem('language', isKo ? 'ko' : 'en');
      });
    }
  };

  document.addEventListener('astro:page-load', initLang);
  initLang();
</script>

